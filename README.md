# Introduction

A deep learning based tool to automatically select the best reconstructed 3D maps within a group of maps.

## Installation

<details>

Clone the repository:

```bash
git clone github.itap.purdue.edu/kiharalab/AutoClass3D
```

Create pixi environment (recommended):

Install pixi:

```bash
curl -fsSL https://pixi.sh/install.sh | bash
```

Install environment:

```bash
pixi install
```

</details>

# AutoClass3D

## AutoSelect3D Standalone Usage without RELION:

<details>

### Arguments for Class3D/InitialModel Selection (All required)

```
-F: Class3D MRC files to be examine, separated by space
-G: The GPU ID to use for the computation, use comma to seperate multiple GPUs
-J: The Job Name
```

### Example for Class3D/InitialModel Selection

```bash
pixi run cryoread -F ./Class3D/job052/class1.mrc ./Class3D/job052/class2.mrc ./Class3D/job052/class3.mrc -G 0,1,2 -J job052_select
```

</details>

## AutoSelect3D Usage with RELION GUI Integration:

<details>

### There are three files associated with RELION integration of AutoSelect3D:

- **gtf_relion4_run_select_class3d.py** <- this is the main file to execute
- gtf_relion4_create_select3d_data_star.py
- gtf_relion4_select3d.py

### Arguments

```
-i/--input: .star file from RELION IntialModel/Class3D run (Auto matically generated by RELION)
-o/--output: Output folder to store all the files (Auto matically generated by RELION)
```

### Example

</details>

## List of output files:

<details>

| File                                                                                                                                    | Description                                                                                                                                      |
|-----------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------|
| {map_name}_CCC_FSC05.txt                                                                                                                | The first line is Real space CCC between CryoREAD prediction probabilities and input map, the second line is FSC 0.5 cutoff between the two maps |
| {map_name}_chain_base_prob.mrc, {map_name}_chain_phosphate_prob.mrc, {map_name}_chain_sugar_prob.mrc, {map_name}_chain_protein_prob.mrc | The predicted probabilities for nitrogenous bases, phosphate backbone, sugar ring, and protein                                                   |
| selected_model_map.mrc                                                                                                                  | The selected map based on maximum CCC criteria                                                                                                   |
| {map_name}_mask_protein.mrc                                                                                                             | The generated protein mask based on a custom cutoff value on protein probability                                                                 |
| {map_name}_segment.mrc                                                                                                                  | The resampled and cropped map used as input for CryoREAD                                                                                         |

</details>

# AutoContour

## Arguments for Auto Contouring

```

-i: Input MRC map file to determine the contour
-o: Output folder to store all the files
-p: Plot all components (Optional, False by default)
-n: Number of intializations (Optional, 3 by default)

```

## Example for GMM Auto Contouring for Rough Masking

```bash
python contour.py -i ./Class3D/job052/class1.mrc -o ./output_folder -p
```

## Example for CryoREAD Auto Refinement Masking

```bash
python contour.py -i ./Class3D/job052/class1.mrc -o ./output_folder -p -r
```